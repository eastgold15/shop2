核心实体关系说明 1. 用户-角色-资源的关系 通过 userResourceRolesTable 实现用户对特定资源的权限控制： // 用户资源角色表结构
{
  userId: "用户ID",
  roleId: "角色ID", 
  resourceType: "exporter" | "factory",
  resourceId: "出口商ID或工厂ID",
  isPrimary: boolean
}
 2. 三种角色示例 • 出口商管理员： {
  userId: "user-123",
  roleId: "exporter-admin-role-id",
  resourceType: "exporter",
  resourceId: "exporter-abc",
  isPrimary: true
}
  • 工厂管理员： {
  userId: "user-456", 
  roleId: "factory-admin-role-id",
  resourceType: "factory",
  resourceId: "factory-xyz",
  isPrimary: true
}
  • 业务员： {
  userId: "user-789",
  roleId: "salesperson-role-id", 
  resourceType: "factory",
  resourceId: "factory-xyz",
  isPrimary: false
}
   如何为出口商添加工厂 步骤 1：创建出口商（如果不存在） INSERT INTO exporters (id, name, code, address, website, is_active, is_verified)
VALUES ('exporter-abc-id', 'Global Trading Co.', 'GT001', 'Address', 'website', true, false);
 步骤 2：为出口商创建工厂 INSERT INTO factories (id, name, code, description, website, address, 
                      category_id, contact_phone, exporter_id, is_active, is_verified)
VALUES ('factory-xyz-id', 'Factory A', 'FA001', 'Description', 'website', 
        'address', 'category-id', 'phone', 'exporter-abc-id', true, false);
 步骤 3：为出口商管理员分配权限 -- 先确保用户存在
INSERT INTO user_resource_roles (user_id, role_id, resource_type, resource_id, is_primary)
VALUES ('user-id', 'exporter-admin-role-id', 'exporter', 'exporter-abc-id', true);
 步骤 4：为工厂分配管理员 -- 工厂管理员需要同时关联到出口商和工厂
INSERT INTO user_resource_roles (user_id, role_id, resource_type, resource_id, is_primary)
VALUES 
  ('factory-admin-user-id', 'factory-admin-role-id', 'exporter', 'exporter-abc-id', true),
  ('factory-admin-user-id', 'factory-admin-role-id', 'factory', 'factory-xyz-id', true);
 API 操作示例 1. 创建工厂的 API // POST /api/factories
{
  name: "新工厂名称",
  code: "FACTORY001", 
  description: "工厂描述",
  website: "工厂网站",
  address: "工厂地址",
  categoryId: "分类ID",
  contactPhone: "联系电话",
  exporterId: "出口商ID"  // 关键！必须指定属于哪个出口商
}
 2. 权限检查流程 // 1. 获取当前用户信息
const userInfo = await getCurrentUser();

// 2. 查询用户资源权限
const userResources = await db
  .select({
    resourceType: userResourceRolesTable.resourceType,
    resourceId: userResourceRolesTable.resourceId,
    roleName: roleTable.name,
  })
  .from(userResourceRolesTable)
  .leftJoin(roleTable, eq(roleTable.id, userResourceRolesTable.roleId))
  .where(eq(userResourceRolesTable.userId, userInfo.id));

// 3. 检查是否有权限创建工厂
const canCreateFactory = userResources.some(
  resource => resource.resourceType === 'exporter' && 
              resource.roleName === 'exporter_admin'
);

// 4. 创建工厂时，确保只能在自己出口商下创建
const factoryData = {
  ...request.body,
  exporterId: userResources.find(r => r.resourceType === 'exporter')?.resourceId
};
 数据隔离机制 1. 出口商隔离：每个出口商管理员只能看到和管理自己的工厂 2. 工厂隔离：工厂管理员只能管理自己的工厂 3. 用户隔离：业务员只能操作自己的数据  实际应用流程 1. 超级管理员创建出口商账号 2. 出口商管理员登录后： ◦ 可以创建新工厂（自动关联到自己的出口商） ◦ 可以创建工厂管理员账号 ◦ 可以创建业务员账号   3. 工厂管理员登录后： ◦ 只能管理分配给自己的工厂 ◦ 可以创建本工厂的业务员   4. 业务员登录后： ◦ 只能操作自己的商品和订单    这样的设计确保了多租户架构下的数据安全和权限隔离。